<!doctype html><html lang=fr class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Atelier Cassandra"><meta name=author content="Hmida Hmida"><link rel=canonical href=https://hhmida.github.io/tp-nosql-cassandra/cluster.html><link rel=prev href=python.html><link rel=next href=solutions.html><link rel=icon href=assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.9"><title>Cluster - Bases de données NoSQL avec Cassandra</title><link rel=stylesheet href=assets/stylesheets/main.f2e4d321.min.css><link rel=stylesheet href=assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=assets/stylesheets/extra.css><script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-QJTFFQBDR6"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-QJTFFQBDR6",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-QJTFFQBDR6",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cluster-cassandra class=md-skip> Aller au contenu </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=En-tête> <a href=index.html title="Bases de données NoSQL avec Cassandra" class="md-header__button md-logo" aria-label="Bases de données NoSQL avec Cassandra" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.374 10.53a3.102 3.102 0 0 1-.428-.222l.555.143c0 .02-.01.036-.01.055l-.117.025zm-.283 1.506-.315.253.852-1.079-1.078.391c.002.017.009.033.009.05a.57.57 0 0 1-.184.42c.102.217.228.424.375.616a3.2 3.2 0 0 1 .34-.651zm.717-2.347-.652-.82a.427.427 0 0 1-.506.162c-.054.073-.083.162-.13.24l1.258.463c.011-.015.019-.031.03-.045zm-1.666.444c-.07.314-.087.637-.05.956a.566.566 0 0 1 .451.475l.946-.606c-.067-.022-.126-.06-.191-.088l-1.119-.08.64-.14a3.186 3.186 0 0 1-.668-.554l-.01.037zM20.1 11.648c-.164.202.833 1.022.833 1.022s-1.654-1.022-2.234-.72c-.278.144.574.811 1.175 1.242-.428-.274-.982-.571-1.175-.408-.328.277 1.565 2.549 1.565 2.549s-2.145-2.322-2.36-2.209c-.214.114.593 1.224.593 1.224s-1.06-1.16-1.35-.959c-.29.202 1.514 3.218 1.514 3.218s-1.956-3.091-2.763-2.574c1.268 2.782.795 3.18.795 3.18s-.162-2.839-1.742-2.764c-.795.038.379 2.12.379 2.12s-1.08-1.902-1.8-1.864c1.326 2.51.854 3.53.854 3.53s.219-2.143-1.58-3.336c.682.606-.427 3.336-.427 3.336s.976-4.023-.719-3.256c-.268.121-.019 2.007-.019 2.007s-.34-2.158-.851-2.045c-.298.066-1.893 2.99-1.893 2.99s1.306-3.16.908-3.027c-.29.096-.833 1.4-.833 1.4s.265-1.287 0-1.363c-.264-.075-1.74 1.363-1.74 1.363s1.097-1.287.908-1.552c-.287-.402-.623-.42-1.022-.265-.581.226-1.363 1.287-1.363 1.287s.78-1.074.643-1.476c-.219-.647-2.46 1.249-2.46 1.249s1.325-1.25 1.022-1.514c-.303-.265-1.947-.183-2.46-.185-1.515-.004-2.039-.36-2.498-.724 1.987.997 3.803-.151 6.094.494l.21.06c-1.3-.558-2.144-1.378-2.226-2.354-.036-.416.074-.827.297-1.222.619-.4 1.29-.773 2.06-1.095a4 4 0 0 0-.064.698c0 2.44 2.203 4.417 4.92 4.417s4.92-1.977 4.92-4.417c0-.45-.083-.881-.223-1.29 1.431.404 2.45.968 3.132 1.335.022.092.045.184.053.279.024.274-.018.547-.11.814.095-.147.198-.288.28-.445.367-.997 1.855.227 1.855.227s-1.085-.454-1.06-.24c.026.215 1.628.96 1.628.96s-1.45-.455-1.362-.114c.088.34 1.817 1.703 1.817 1.703s-1.956-1.489-2.12-1.287zm-7.268 2.65.042-.008-.06.01zM9.256 9.753c.12.13.26.234.396.343l.927-.029-1.064-.788c-.093.154-.195.303-.26.474Zm10.62 3.44c.3.215.54.373.54.373s-.24-.181-.54-.374zM7.507 8.617c-.14.229-.214.492-.215.76a3.99 3.99 0 0 0 2.358 3.64c0-.005.002-.01.003-.014a3.19 3.19 0 0 1-.58-.788c-.648.099-.926-.794-.336-1.08a3.174 3.174 0 0 1 .138-1.388 3.162 3.162 0 0 1-.52-1.36c-.296.07-.579.147-.848.23Zm1.488.82c.108-.24.243-.46.402-.661a.435.435 0 0 1 .568-.557c.077-.059.166-.099.248-.15a16.17 16.17 0 0 0-1.727.284c.114.388.272.76.509 1.084Zm2.285 3.928c1.4 0 2.633-.723 3.344-1.816a3.399 3.399 0 0 0-1.265-.539l-.297-.023.916.9-1.197-.467.704 1.078-1.074-.832-.012.006.347 1.278-.596-1.134-.098 1.33-.401-1.326-.472 1.261.114-1.359c-.006-.002-.01-.006-.015-.008l-.814 1.154.286-1.067c-.34.322-.605.713-.781 1.146.095.102.197.198.303.29.322.083.66.128 1.008.128zm10.145-4.434c.971-.567 1.716-1.955 1.716-1.955s-1.893 1.955-3.205 1.665c1.186-.934 1.766-2.549 1.766-2.549s-1.506 2.325-2.448 2.423c1.086-.959 1.54-2.322 1.54-2.322s-1.237 1.817-2.196 1.944c1.287-1.161 1.338-1.893 1.338-1.893s-1.781 2.302-2.499 1.943c.858-.934 1.439-2.12 1.439-2.12s-1.489 2.019-1.893 1.69c-.277-.05.454-.958.454-.958s-.908.807-1.16.606c.454-.278 1.236-1.64 1.236-1.64S16 7.505 15.621 7.304l.731-1.483s-.73 1.483-1.715 1.23c.454-.58.63-1.112.63-1.112s-.756 1.213-1.69.885c-.22-.077.273-.635.273-.635s-.626.61-1.055.534c-.43-.076.025-.858.025-.858s-.757 1.186-.908 1.136c-.152-.05.075-.833.075-.833s-.555.908-.858.858c-.302-.05 0-.934 0-.934s-.328.984-.58.909c-.252-.076-.303-.656-.303-.656s-.068.788-.429.858c-2.725.53-5.728 1.69-9.489 5.45C3.887 10.738 5.3 7.91 11.962 7.659c5.044-.191 7.399 2.137 8.177 2.17C22.51 9.93 24 7.633 24 7.633s-1.489 1.716-2.574 1.3zm-7.74.872-.608.464v.001l.054.003a3.35 3.35 0 0 0 .554-.468zm1.583-.426c0-.536-.237-.929-.594-1.217a3.178 3.178 0 0 1-.165.825.393.393 0 0 1-.328.681c-.154.233-.34.445-.549.63l.661.034-.995.237c-.025.018-.045.041-.07.058a3.194 3.194 0 0 1 1.536.691c.32-.574.504-1.235.504-1.94zM10.99 7.996a3.5 3.5 0 0 0-.785.46.427.427 0 0 1-.013.357l.885.643.023-.016-.36-1.262.627 1.12c.018-.006.04-.006.058-.011l-.02-1.251.398 1.163.477-1.15.016 1.268c.004.001.007.005.012.007l.713-1.005-.363 1.218.009.01 1.04-.69-.759 1.05.002.005.95-.34c.012-.016.028-.029.041-.045a.395.395 0 0 1 .394-.632 3.43 3.43 0 0 0 .27-.784 13.99 13.99 0 0 0-2.798-.168c-.286.011-.55.033-.817.053Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Bases de données NoSQL avec Cassandra </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Cluster </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=red aria-label="Basculer au mode sombre" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Basculer au mode sombre" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=red aria-label="Basculer au mode clair" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Basculer au mode clair" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Rechercher placeholder=Rechercher autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Recherche> <button type=reset class="md-search__icon md-icon" title=Effacer aria-label=Effacer tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initialisation de la recherche </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Onglets data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=index.html class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=installation.html class=md-tabs__link> Installation </a> </li> <li class=md-tabs__item> <a href=ldd_lmd.html class=md-tabs__link> Opérations de base </a> </li> <li class=md-tabs__item> <a href=interrogation.html class=md-tabs__link> Interrogation </a> </li> <li class=md-tabs__item> <a href=Collections_UDT.html class=md-tabs__link> Collections et UDT </a> </li> <li class=md-tabs__item> <a href=python.html class=md-tabs__link> Client Python pour Cassandra </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=cluster.html class=md-tabs__link> Cluster </a> </li> <li class=md-tabs__item> <a href=solutions.html class=md-tabs__link> Solutions </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=index.html title="Bases de données NoSQL avec Cassandra" class="md-nav__button md-logo" aria-label="Bases de données NoSQL avec Cassandra" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.374 10.53a3.102 3.102 0 0 1-.428-.222l.555.143c0 .02-.01.036-.01.055l-.117.025zm-.283 1.506-.315.253.852-1.079-1.078.391c.002.017.009.033.009.05a.57.57 0 0 1-.184.42c.102.217.228.424.375.616a3.2 3.2 0 0 1 .34-.651zm.717-2.347-.652-.82a.427.427 0 0 1-.506.162c-.054.073-.083.162-.13.24l1.258.463c.011-.015.019-.031.03-.045zm-1.666.444c-.07.314-.087.637-.05.956a.566.566 0 0 1 .451.475l.946-.606c-.067-.022-.126-.06-.191-.088l-1.119-.08.64-.14a3.186 3.186 0 0 1-.668-.554l-.01.037zM20.1 11.648c-.164.202.833 1.022.833 1.022s-1.654-1.022-2.234-.72c-.278.144.574.811 1.175 1.242-.428-.274-.982-.571-1.175-.408-.328.277 1.565 2.549 1.565 2.549s-2.145-2.322-2.36-2.209c-.214.114.593 1.224.593 1.224s-1.06-1.16-1.35-.959c-.29.202 1.514 3.218 1.514 3.218s-1.956-3.091-2.763-2.574c1.268 2.782.795 3.18.795 3.18s-.162-2.839-1.742-2.764c-.795.038.379 2.12.379 2.12s-1.08-1.902-1.8-1.864c1.326 2.51.854 3.53.854 3.53s.219-2.143-1.58-3.336c.682.606-.427 3.336-.427 3.336s.976-4.023-.719-3.256c-.268.121-.019 2.007-.019 2.007s-.34-2.158-.851-2.045c-.298.066-1.893 2.99-1.893 2.99s1.306-3.16.908-3.027c-.29.096-.833 1.4-.833 1.4s.265-1.287 0-1.363c-.264-.075-1.74 1.363-1.74 1.363s1.097-1.287.908-1.552c-.287-.402-.623-.42-1.022-.265-.581.226-1.363 1.287-1.363 1.287s.78-1.074.643-1.476c-.219-.647-2.46 1.249-2.46 1.249s1.325-1.25 1.022-1.514c-.303-.265-1.947-.183-2.46-.185-1.515-.004-2.039-.36-2.498-.724 1.987.997 3.803-.151 6.094.494l.21.06c-1.3-.558-2.144-1.378-2.226-2.354-.036-.416.074-.827.297-1.222.619-.4 1.29-.773 2.06-1.095a4 4 0 0 0-.064.698c0 2.44 2.203 4.417 4.92 4.417s4.92-1.977 4.92-4.417c0-.45-.083-.881-.223-1.29 1.431.404 2.45.968 3.132 1.335.022.092.045.184.053.279.024.274-.018.547-.11.814.095-.147.198-.288.28-.445.367-.997 1.855.227 1.855.227s-1.085-.454-1.06-.24c.026.215 1.628.96 1.628.96s-1.45-.455-1.362-.114c.088.34 1.817 1.703 1.817 1.703s-1.956-1.489-2.12-1.287zm-7.268 2.65.042-.008-.06.01zM9.256 9.753c.12.13.26.234.396.343l.927-.029-1.064-.788c-.093.154-.195.303-.26.474Zm10.62 3.44c.3.215.54.373.54.373s-.24-.181-.54-.374zM7.507 8.617c-.14.229-.214.492-.215.76a3.99 3.99 0 0 0 2.358 3.64c0-.005.002-.01.003-.014a3.19 3.19 0 0 1-.58-.788c-.648.099-.926-.794-.336-1.08a3.174 3.174 0 0 1 .138-1.388 3.162 3.162 0 0 1-.52-1.36c-.296.07-.579.147-.848.23Zm1.488.82c.108-.24.243-.46.402-.661a.435.435 0 0 1 .568-.557c.077-.059.166-.099.248-.15a16.17 16.17 0 0 0-1.727.284c.114.388.272.76.509 1.084Zm2.285 3.928c1.4 0 2.633-.723 3.344-1.816a3.399 3.399 0 0 0-1.265-.539l-.297-.023.916.9-1.197-.467.704 1.078-1.074-.832-.012.006.347 1.278-.596-1.134-.098 1.33-.401-1.326-.472 1.261.114-1.359c-.006-.002-.01-.006-.015-.008l-.814 1.154.286-1.067c-.34.322-.605.713-.781 1.146.095.102.197.198.303.29.322.083.66.128 1.008.128zm10.145-4.434c.971-.567 1.716-1.955 1.716-1.955s-1.893 1.955-3.205 1.665c1.186-.934 1.766-2.549 1.766-2.549s-1.506 2.325-2.448 2.423c1.086-.959 1.54-2.322 1.54-2.322s-1.237 1.817-2.196 1.944c1.287-1.161 1.338-1.893 1.338-1.893s-1.781 2.302-2.499 1.943c.858-.934 1.439-2.12 1.439-2.12s-1.489 2.019-1.893 1.69c-.277-.05.454-.958.454-.958s-.908.807-1.16.606c.454-.278 1.236-1.64 1.236-1.64S16 7.505 15.621 7.304l.731-1.483s-.73 1.483-1.715 1.23c.454-.58.63-1.112.63-1.112s-.756 1.213-1.69.885c-.22-.077.273-.635.273-.635s-.626.61-1.055.534c-.43-.076.025-.858.025-.858s-.757 1.186-.908 1.136c-.152-.05.075-.833.075-.833s-.555.908-.858.858c-.302-.05 0-.934 0-.934s-.328.984-.58.909c-.252-.076-.303-.656-.303-.656s-.068.788-.429.858c-2.725.53-5.728 1.69-9.489 5.45C3.887 10.738 5.3 7.91 11.962 7.659c5.044-.191 7.399 2.137 8.177 2.17C22.51 9.93 24 7.633 24 7.633s-1.489 1.716-2.574 1.3zm-7.74.872-.608.464v.001l.054.003a3.35 3.35 0 0 0 .554-.468zm1.583-.426c0-.536-.237-.929-.594-1.217a3.178 3.178 0 0 1-.165.825.393.393 0 0 1-.328.681c-.154.233-.34.445-.549.63l.661.034-.995.237c-.025.018-.045.041-.07.058a3.194 3.194 0 0 1 1.536.691c.32-.574.504-1.235.504-1.94zM10.99 7.996a3.5 3.5 0 0 0-.785.46.427.427 0 0 1-.013.357l.885.643.023-.016-.36-1.262.627 1.12c.018-.006.04-.006.058-.011l-.02-1.251.398 1.163.477-1.15.016 1.268c.004.001.007.005.012.007l.713-1.005-.363 1.218.009.01 1.04-.69-.759 1.05.002.005.95-.34c.012-.016.028-.029.041-.045a.395.395 0 0 1 .394-.632 3.43 3.43 0 0 0 .27-.784 13.99 13.99 0 0 0-2.798-.168c-.286.011-.55.033-.817.053Z"/></svg> </a> Bases de données NoSQL avec Cassandra </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=index.html class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=installation.html class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=ldd_lmd.html class=md-nav__link> <span class=md-ellipsis> Opérations de base </span> </a> </li> <li class=md-nav__item> <a href=interrogation.html class=md-nav__link> <span class=md-ellipsis> Interrogation </span> </a> </li> <li class=md-nav__item> <a href=Collections_UDT.html class=md-nav__link> <span class=md-ellipsis> Collections et UDT </span> </a> </li> <li class=md-nav__item> <a href=python.html class=md-nav__link> <span class=md-ellipsis> Client Python pour Cassandra </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Cluster </span> <span class="md-nav__icon md-icon"></span> </label> <a href=cluster.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Cluster </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table des matières"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table des matières </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#creer-un-cluster-cassandra class=md-nav__link> <span class=md-ellipsis> Créer un cluster Cassandra </span> </a> </li> <li class=md-nav__item> <a href=#surveillance-du-cluster class=md-nav__link> <span class=md-ellipsis> Surveillance du cluster </span> </a> </li> <li class=md-nav__item> <a href=#mise-en-oeuvre-de-la-replication class=md-nav__link> <span class=md-ellipsis> Mise en oeuvre de la réplication </span> </a> </li> <li class=md-nav__item> <a href=#mise-en-oeuvre-du-sharding class=md-nav__link> <span class=md-ellipsis> Mise en oeuvre du Sharding </span> </a> </li> <li class=md-nav__item> <a href=#transactions-et-coherence class=md-nav__link> <span class=md-ellipsis> Transactions et cohérence </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=solutions.html class=md-nav__link> <span class=md-ellipsis> Solutions </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <p><img src=assets/images/cluster/replication.svg width=30% height=30%></p> <h1 id=cluster-cassandra>Cluster Cassandra<a class=headerlink href=#cluster-cassandra title="Permanent link">&para;</a></h1> <hr> <h2 id=creer-un-cluster-cassandra>Créer un cluster Cassandra<a class=headerlink href=#creer-un-cluster-cassandra title="Permanent link">&para;</a></h2> <p>La création d'un cluster avec Docker est simple. En effet, pour configurer les noeuds, il existe 2 méthodes :</p> <ul> <li>Utiliser des fichiers de configuration <code>cassandra.yaml</code> et les monter comme volumes (avec l'option -v).</li> <li>Utiliser les variables d'environnements (option -e) pour modifier les paramètres de configuration par défaut.</li> </ul> <p>Dans ce quit suit nous utilisons les variables d'environnement dont :</p> <ul> <li><strong>CASSANDRA_HOST</strong> : nom du noeud ou son adresse IP.</li> <li><strong>CASSANDRA_CLUSTER_NAME</strong> : Nom du cluster ququel appartient le noeud.</li> <li><strong>CASSANDRA_SEEDS</strong> : les noeuds du cluster Cassandra permettant le démarrage du cluster (bootstrap) contactés par les nouveaux noeuds.</li> <li><strong>CASSANDRA_ENDPOINT_SNITCH</strong> : Nom du Snitch (détermine les Racks et Datacenters auxquels apprtiennent les noeuds). Par défaut SimpleSnitch.</li> <li><strong>CASSANDRA_PASSWORD</strong> : Mot de passe pour l'utilisateur. Par défault: cassandra.</li> <li><strong>CASSANDRA_PASSWORD_SEEDER</strong> : Un noeud par cluster qui permet de changer le mot de passe lors de l'initialisation.</li> <li><strong>CASSANDRA_NUM_TOKENS</strong> : nombre de tokens gérés par un noeud. </li> <li>...</li> </ul> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Créer un réseau Docker <div class=highlight><pre><span></span><code>docker<span class=w> </span>network<span class=w> </span>create<span class=w> </span>cassandra_network
</code></pre></div></p> <p><img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Créer le premier noeud</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span>cass1<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--net<span class=o>=</span>cassandra_network<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-p<span class=w> </span><span class=m>9042</span>:9042<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_CLUSTER_NAME</span><span class=o>=</span>cassandra-cluster<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_NUM_TOKENS</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_PASSWORD_SEEDER</span><span class=o>=</span>yes<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_PASSWORD</span><span class=o>=</span>mypassword<span class=w> </span><span class=se>\</span>
<span class=w>  </span>cassandra:4.0.6
</code></pre></div> <p><img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> Les noeuds appartenant au même cluster ont le même <code>CASSANDRA_CLUSTER_NAME</code>.</p> <p><img alt=3⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/33-20e3.svg title=:three:> Créer 2 autres noeuds</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span>cass2<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--net<span class=o>=</span>cassandra_network<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_CLUSTER_NAME</span><span class=o>=</span>cassandra-cluster<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_NUM_TOKENS</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_SEEDS</span><span class=o>=</span>cass1<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_PASSWORD</span><span class=o>=</span>mypassword<span class=w> </span><span class=se>\</span>
<span class=w>  </span>cassandra:4.0.6
docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span>cass3<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--net<span class=o>=</span>cassandra_network<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_CLUSTER_NAME</span><span class=o>=</span>cassandra-cluster<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_NUM_TOKENS</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_SEEDS</span><span class=o>=</span>cass1<span class=w> </span><span class=se>\</span>
<span class=w>  </span>-e<span class=w> </span><span class=nv>CASSANDRA_PASSWORD</span><span class=o>=</span>mypassword<span class=w> </span><span class=se>\</span>
<span class=w>  </span>cassandra:4.0.6
</code></pre></div> <p><img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> Maintenant, vous avez un cluster de 3 noeuds.</p> <!--???+ hint "Cluster avec Docker-Compose"
    Avec Docker Compose, créer le fichier `docker-compose.yml` suivant:

    <div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>
<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cassandra_network</span><span class="p">:</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cass1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra:4.0.6</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra_network</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_CLUSTER_NAME=cassandra-cluster</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_PASSWORD_SEEDER=yes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_PASSWORD=mypassword</span>

<span class="w">  </span><span class="nt">cass2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra:4.0.6</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra_network</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_CLUSTER_NAME=cassandra-cluster</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_SEEDS=cass1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_PASSWORD=mypassword</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">cassandra-node2</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra:4.0.6</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra_network</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_CLUSTER_NAME=cassandra-cluster</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_SEEDS=cassandra-node1,cassandra-node2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_PASSWORD=mypassword</span>
</code></pre></div>
    Ensuite, démarrer le cluster :
    <div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
--> <h2 id=surveillance-du-cluster>Surveillance du cluster<a class=headerlink href=#surveillance-du-cluster title="Permanent link">&para;</a></h2> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Vérifier l'état du cluster</p> <p><div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>status
</code></pre></div> <img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Voir la répartition des tokens</p> <p><div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>ring
</code></pre></div> <img alt=3⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/33-20e3.svg title=:three:> Récupérer les statitiques sur les tables</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>tablestats
</code></pre></div> <details class=info open=open> <summary>JMX</summary> <p>Cassandra est compatible avec JMX. Un standard qui permet de publier des métriques sur l'utilisation des ressources par Cassandra.</p> <p>Des outils VisualVM permettent de visualiser ces mesures. Toutefois, il faut préparer le container Docker pour une connexion externe JMX. Avec docker 1. Créer un fichier jmxremote.password contenant une ligne : <code>controlRole jmxpassword</code> 2. Démarrer le container avec la commande <div class=highlight><pre><span></span><code>docker<span class=w> </span>run<span class=w> </span>--name<span class=w> </span>containerized-cassandra<span class=w> </span>-p<span class=w> </span><span class=m>7199</span>:7199<span class=w> </span>-v<span class=w> </span>jmxremote.password:/etc/cassandra/jmxremote.password<span class=w> </span>-e<span class=w> </span><span class=nv>LOCAL_JMX</span><span class=o>=</span><span class=s1>&#39;no&#39;</span><span class=w> </span>cassandra:4.0.6
</code></pre></div> 3. Se connecter avec VisualVM sur localhost:7199 avec les paramètres d'authentification controlRole et jmxpassword</p> </details> <h2 id=mise-en-oeuvre-de-la-replication>Mise en oeuvre de la réplication<a class=headerlink href=#mise-en-oeuvre-de-la-replication title="Permanent link">&para;</a></h2> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Se connecter à un noeud du cluster avec cqlsh <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>cass1<span class=w> </span>cqlsh
</code></pre></div></p> <p><img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Créer un Keyspace avec un facteur de réplication de 3 et insérer des données <div class=highlight><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=n>KEYSPACE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=n>test_replication</span>
<span class=k>WITH</span><span class=w> </span><span class=n>REPLICATION</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=s1>&#39;class&#39;</span><span class=w> </span><span class=p>:</span><span class=s1>&#39;SimpleStrategy&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;replication_factor&#39;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=err>}</span><span class=p>;</span>
<span class=n>USE</span><span class=w> </span><span class=n>test_replication</span><span class=p>;</span>
<span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>cours</span><span class=w> </span><span class=p>(</span>
<span class=w>  </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span>
<span class=w>  </span><span class=n>nom</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>,</span>
<span class=w>  </span><span class=n>coefficient</span><span class=w> </span><span class=nb>FLOAT</span><span class=p>,</span>
<span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span>
<span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>cours</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>nom</span><span class=p>,</span><span class=w> </span><span class=n>coefficient</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;NoSQL&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>.</span><span class=mi>5</span><span class=p>);</span>
</code></pre></div></p> <p><img alt=3⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/33-20e3.svg title=:three:> Vérifier la réplication des lignes : Afficher les noeuds ayant une copie du cours 1 <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>getendpoints<span class=w> </span>test_replication<span class=w> </span>cours<span class=w> </span><span class=m>1</span>
</code></pre></div> <img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> pour un facteur de réplication 3, 3 noeuds différents doivent être affichés</p> <p><img alt=5⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/35-20e3.svg title=:five:> Vérifier les écritures</p> <p><div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>cfstats<span class=w> </span>test_replication
docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass2<span class=w> </span>nodetool<span class=w> </span>cfstats<span class=w> </span>test_replication
docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass3<span class=w> </span>nodetool<span class=w> </span>cfstats<span class=w> </span>test_replication
</code></pre></div> <img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> La valeur de Write Count doit être égale à 1 pour trois noeuds consécutifs sur l'anneau et 0 pour les autres.</p> <p><img alt=6⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/36-20e3.svg title=:six:> Vérifier la disponibilité des données à partir de tous les noeuds Se connecter à un noeud avec Write Count égal à 0 et accéder aux données. Si cass3 ne contient pas les noeuds : <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>cass3<span class=w> </span>cqlsh
</code></pre></div> puis </p> <div class=highlight><pre><span></span><code><span class=n>USE</span><span class=w> </span><span class=n>test_replication</span><span class=p>;</span>
<span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>cours</span><span class=p>;</span>
</code></pre></div> <details class=info open=open> <summary>Réparer l'état de réplication</summary> <p>Pour forcer la synchronisation des données d'un Keyspace : <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>repair<span class=w> </span>test_replication
</code></pre></div></p> </details> <h2 id=mise-en-oeuvre-du-sharding>Mise en oeuvre du Sharding<a class=headerlink href=#mise-en-oeuvre-du-sharding title="Permanent link">&para;</a></h2> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Vérifier les token attribué aux noeuds du cluster</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>ring
</code></pre></div> <p>Un résultat possible est comme l'aperçu suivant :</p> <div class=highlight><pre><span></span><code>root@ab7a361c7e9b:/#<span class=w> </span>nodetool<span class=w> </span>ring

Datacenter:<span class=w> </span><span class=nv>datacenter1</span>
<span class=o>==========</span>
Address<span class=w>          </span>Rack<span class=w>        </span>Status<span class=w> </span>State<span class=w>   </span>Load<span class=w>            </span>Owns<span class=w>                </span>Token<span class=w>                                       </span>
<span class=w>                                                                                </span><span class=m>6081392343852191785</span><span class=w>                         </span>
<span class=m>172</span>.26.0.2<span class=w>       </span>rack1<span class=w>       </span>Up<span class=w>     </span>Normal<span class=w>  </span><span class=m>96</span>.15<span class=w> </span>KiB<span class=w>       </span><span class=m>63</span>.08%<span class=w>              </span>-5126891207358132333<span class=w>                        </span>
<span class=m>172</span>.26.0.4<span class=w>       </span>rack1<span class=w>       </span>Up<span class=w>     </span>Normal<span class=w>  </span><span class=m>139</span>.66<span class=w> </span>KiB<span class=w>      </span><span class=m>76</span>.16%<span class=w>              </span><span class=m>1683513220770616142</span><span class=w>                         </span>
<span class=m>172</span>.26.0.3<span class=w>       </span>rack1<span class=w>       </span>Up<span class=w>     </span>Normal<span class=w>  </span><span class=m>96</span>.06<span class=w> </span>KiB<span class=w>       </span><span class=m>60</span>.76%<span class=w>              </span><span class=m>6081392343852191785</span><span class=w>  </span>
</code></pre></div> <p><img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> Les noeuds de l'anneau virtuel sont 172.26.0.2 (cass1) puis 172.26.0.4 (cass3) et 172.26.0.3 (cass2) ayant respectivement les tokens -5126891207358132333, 1683513220770616142 et 1683513220770616142</p> <details class=hint open=open> <summary>Adresse IP</summary> <p>Pour obtenir l'adresse IP du container cass1 <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>ip<span class=w> </span>addr
</code></pre></div> ou <div class=highlight><pre><span></span><code>docker<span class=w> </span>inspect<span class=w> </span>-f<span class=w> </span><span class=s1>&#39;{{ .NetworkSettings.Networks.cassandra_network.IPAddress }}&#39;</span><span class=w> </span>cass1
</code></pre></div></p> </details> <p><img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Insérer d'autres lignes</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>cass1<span class=w> </span>cqlsh
</code></pre></div> <p>puis <div class=highlight><pre><span></span><code><span class=n>USE</span><span class=w> </span><span class=n>test_replication</span><span class=p>;</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>cours</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>nom</span><span class=p>,</span><span class=w> </span><span class=n>coefficient</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Python&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>cours</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>nom</span><span class=p>,</span><span class=w> </span><span class=n>coefficient</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>100</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Statistiques&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>.</span><span class=mi>5</span><span class=p>);</span>
</code></pre></div></p> <p><img alt=3⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/33-20e3.svg title=:three:> Afficher les tokens des données insérées</p> <div class=highlight><pre><span></span><code><span class=k>select</span><span class=w> </span><span class=n>token</span><span class=p>(</span><span class=n>id</span><span class=p>),</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>test_replication</span><span class=p>.</span><span class=n>cours</span><span class=p>;</span>
<span class=w> </span><span class=k>system</span><span class=p>.</span><span class=n>token</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=n>id</span>
<span class=c1>----------------------+-----</span>
<span class=w> </span><span class=o>-</span><span class=mi>6715243485458697746</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=mi>10</span>
<span class=w> </span><span class=o>-</span><span class=mi>4069959284402364209</span><span class=w> </span><span class=o>|</span><span class=w>   </span><span class=mi>1</span>
<span class=w>  </span><span class=mi>2008715943680221220</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>100</span>

<span class=p>(</span><span class=mi>3</span><span class=w> </span><span class=k>rows</span><span class=p>)</span>
</code></pre></div> <p><img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> En examinant les valeurs, l'affectation des lignes selin l'id (clé primaire) aux noeuds du cluster est obtenu ainsi :</p> <ul> <li>token(1) = -4069959284402364209 dans ]-5126891207358132333, 1683513220770616142[ ==&gt; noeud 172.26.0.4</li> <li>token(10) = -6715243485458697746 &lt; -5126891207358132333 ==&gt; noeud 172.26.0.2</li> <li>token (100) = 2008715943680221220 dans ]1683513220770616142, 6081392343852191785[ ==&gt; noeud 172.26.0.3</li> </ul> <p><img alt=4⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/34-20e3.svg title=:four:> Sharding et replication</p> <p>Vu que la réplication est aussi activée alors chaque ligne est répliquée dans le noeud suivant sur l'anneau.</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>cass1<span class=w> </span>bash
root@ab7a361c7e9b:/#<span class=w> </span>nodetool<span class=w> </span>getendpoints<span class=w> </span>test_replication<span class=w> </span>cours<span class=w> </span><span class=m>1</span>
<span class=m>172</span>.26.0.4
<span class=m>172</span>.26.0.3
root@ab7a361c7e9b:/#<span class=w> </span>nodetool<span class=w> </span>getendpoints<span class=w> </span>test_replication<span class=w> </span>cours<span class=w> </span><span class=m>10</span>
<span class=m>172</span>.26.0.2
<span class=m>172</span>.26.0.4
root@ab7a361c7e9b:/#<span class=w> </span>nodetool<span class=w> </span>getendpoints<span class=w> </span>test_replication<span class=w> </span>cours<span class=w> </span><span class=m>100</span>
<span class=m>172</span>.26.0.3
<span class=m>172</span>.26.0.2
</code></pre></div> <h2 id=transactions-et-coherence>Transactions et cohérence<a class=headerlink href=#transactions-et-coherence title="Permanent link">&para;</a></h2> <p><img alt=1⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/31-20e3.svg title=:one:> Vérifier le niveau de cohérance par défaut</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>cass1<span class=w> </span>cqlsh
</code></pre></div> <p>puis</p> <p><div class=highlight><pre><span></span><code><span class=n>CONSISTENCY</span>
<span class=k>Current</span><span class=w> </span><span class=n>consistency</span><span class=w> </span><span class=k>level</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>ONE</span><span class=p>.</span>
</code></pre></div> <img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> Le niveau de cohérence est ONE.</p> <details class=info open=open> <summary>Niveaux de cohérence Cassandra</summary> <ul> <li><strong>ONE (TWO, THREE)</strong>: Le coordinateur reçoit la réponse du premier réplica (ou de deux, ou de trois) et la renvoie au client. Cette stratégie assure une haute disponibilité, mais au risque de renvoyer un document qui n’est pas synchronisé avec les autres réplicas. Dans ce cas, la cohérence des données n’est pas assurée</li> <li><strong>QUORUM</strong> : Le coordinateur reçoit la réponse de au moins réplicas. C’est la stratégie qui représente le meilleur compromis</li> <li><strong>ALL</strong> : Le coordinateur reçoit la réponse de tous les réplicas. Si un réplica ne répond pas, alors la requête sera en échec. C’est la stratégie qui assure la meilleure cohérence des données, mais au prix de la disponibilité du système</li> </ul> </details> <p><img alt=2⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/32-20e3.svg title=:two:> Arrêter les noeuds <div class=highlight><pre><span></span><code>docker<span class=w> </span>pause<span class=w> </span>cass2<span class=w> </span>cass3
docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>cass1<span class=w> </span>nodetool<span class=w> </span>ring
</code></pre></div></p> <p><img alt=3⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/33-20e3.svg title=:three:> Mettre le niveau de cohérence à ALL et interroger les données</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>cass1<span class=w> </span>cqlsh
</code></pre></div> <p>puis</p> <p><div class=highlight><pre><span></span><code><span class=n>use</span><span class=w> </span><span class=n>test_replication</span><span class=p>;</span>
<span class=n>consistency</span><span class=w> </span><span class=k>all</span><span class=p>;</span>
<span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>cours</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>cours</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
<span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>cours</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</code></pre></div> Comme attendu, la réponse renvoyée au client est une erreur pour toutes les requêtes. </p> <p><img alt=4⃣ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/34-20e3.svg title=:four:> Tester de nouveau le iveau ONE</p> <div class=highlight><pre><span></span><code>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>cass1<span class=w> </span>cqlsh
</code></pre></div> <p>puis</p> <p><div class=highlight><pre><span></span><code><span class=n>use</span><span class=w> </span><span class=n>test_replication</span><span class=p>;</span>
<span class=n>consistency</span><span class=w> </span><span class=n>one</span><span class=p>;</span>
<span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>cours</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>cours</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
<span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>cours</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span>
</code></pre></div> <img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg title=:bulb:> Vu que le noeud cass1 contient les cours 10 et 100 (voir sharding), seule la première requête génère une erreur.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Retour en haut de la page </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label="Pied de page"> <a href=python.html class="md-footer__link md-footer__link--prev" aria-label="Précédent: Client Python pour Cassandra"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Précédent </span> <div class=md-ellipsis> Client Python pour Cassandra </div> </div> </a> <a href=solutions.html class="md-footer__link md-footer__link--next" aria-label="Suivant: Solutions"> <div class=md-footer__title> <span class=md-footer__direction> Suivant </span> <div class=md-ellipsis> Solutions </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 - Dr. Hmida Hmida </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://gitlab.com/hhmida target=_blank rel=noopener title=gitlab.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81-2.9-.295-5.7.083-8.4 1.11-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.09 18.09 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3 4.7 0 9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82z"/></svg> </a> <a href=https://github.com/hhmida target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://linkedin.com/in/hhmida target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": ".", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.instant.progress", "navigation.top", "toc.integrate", "content.code.annotate", "content.code.copy", "navigation.footer"], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}}</script> <script src=assets/javascripts/bundle.8fd75fb4.min.js></script> </body> </html>